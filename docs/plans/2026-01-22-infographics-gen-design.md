# InfographicsGen — Дизайн-документ

> Микроприложение для генерации инфографики товаров для Wildberries и Ozon

**Дата:** 2026-01-22
**Статус:** Согласован

---

## Обзор

Внутренний инструмент для команды, позволяющий:
- Генерировать продающую инфографику (главное фото, карусель, рич-контент)
- Использовать AI (Nano Banana Pro) для создания изображений на основе фото товара
- Парсить данные с карточки ВБ (ключи, отзывы, характеристики)
- Проводить A/B тесты с полуавтоматическими рекомендациями
- Создавать SEO-оптимизированный рич-контент

---

## Архитектура

```
┌─────────────────────────────────────────────────────┐
│                    Frontend                          │
│              Next.js 15 + React 19                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  Проекты    │  │  Редактор   │  │  Аналитика  │  │
│  │  товаров    │  │  Konva.js   │  │  A/B тесты  │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────┘
                         │
┌─────────────────────────────────────────────────────┐
│                 Backend (Convex)                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │  Queries    │  │  Mutations  │  │  Actions    │  │
│  │  (чтение)   │  │  (запись)   │  │  (внешние)  │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  │
└─────────────────────────────────────────────────────┘
                         │
┌─────────────────────────────────────────────────────┐
│              Внешние сервисы                         │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │
│  │ Nano Banana │  │  OpenAI     │  │   WB API    │  │
│  │  Pro (fal)  │  │  GPT-4o     │  │  Analytics  │  │
│  └─────────────┘  └─────────────┘  └─────────────┘  │
│  ┌─────────────┐                                    │
│  │ Cloudflare  │                                    │
│  │     R2      │                                    │
│  └─────────────┘                                    │
└─────────────────────────────────────────────────────┘
```

**Принципы:**
- Монорепо: фронт и бэкенд в одном проекте
- Real-time обновления через Convex subscriptions
- Файлы (изображения) хранятся в R2, в Convex только ссылки

---

## Модель данных (Convex Schema)

```typescript
// projects — проекты товаров
projects: {
  name: string                    // "Кроссовки Nike Air Max"
  wbUrl?: string                  // ссылка на товар ВБ
  wbArticle?: string              // артикул ВБ
  status: "draft" | "active" | "archived"
  createdAt: number
}

// productData — распарсенные данные о товаре
productData: {
  projectId: Id<"projects">
  keywords: string[]              // ["кроссовки", "nike", "спортивная обувь"]
  title: string                   // название с ВБ
  description: string             // описание
  characteristics: Record<string, string>  // характеристики
  reviews: Array<{text, rating, date}>     // отзывы
  competitors: Array<{url, title}>         // конкуренты
  fetchedAt: number
}

// assets — загруженные файлы (фото товара, референсы)
assets: {
  projectId: Id<"projects">
  type: "product" | "reference" | "generated"
  url: string                     // ссылка на R2
  filename: string
  createdAt: number
}

// generations — сгенерированные изображения
generations: {
  projectId: Id<"projects">
  type: "main" | "carousel" | "rich_content"
  prompt: string                  // промпт для AI
  imageUrl: string                // результат
  status: "pending" | "done" | "failed"
  slotIndex?: number              // позиция в карусели (0-29)
  createdAt: number
}

// abTests — A/B тесты
abTests: {
  projectId: Id<"projects">
  name: string
  variants: Array<{generationId: Id<"generations">, label: string}>
  activeVariant: number
  status: "running" | "paused" | "completed"
  startedAt: number
}

// analytics — снэпшоты аналитики с ВБ
analytics: {
  abTestId: Id<"abTests">
  variantIndex: number
  date: string                    // "2026-01-22"
  views: number
  clicks: number
  cart: number
  orders: number
  ctr: number
  conversion: number
}
```

---

## Пользовательский workflow

### Шаг 1: Создание проекта
```
[Новый проект] → Название + ссылка на товар ВБ (опционально)
                           ↓
              Система парсит данные с ВБ:
              • Ключевые слова (через WB API search-report)
              • Название, описание, характеристики
              • Отзывы (топ-50 по полезности)
              • Конкуренты в категории
```

### Шаг 2: Загрузка материалов
```
[Фото товара]     → PNG без фона (обязательно)
[Референсы стиля] → 1-4 примера инфографики (опционально)
```

### Шаг 3: Генерация инфографики
```
1. Выбор типа: Главное фото / Карусель / Рич-контент
2. Настройка:
   • Выбор слота (для карусели: 1-30)
   • Акцент на УТП (из ключей/отзывов)
   • Стиль текста (минимум/средне/много)
   • Доп. инструкции
3. AI генерирует изображение
4. [Принять] [Регенерировать] [Редактировать]
```

### Шаг 4: Редактирование (опционально)
```
Canvas-редактор (Konva.js):
• Перемещение элементов
• Изменение текста
• Добавление иконок/бейджей
• Экспорт в PNG/JPG
```

---

## A/B тестирование

### Механика (полуавтомат):
1. Выбираешь 2-4 варианта из сгенерированных изображений
2. Создаёшь тест, устанавливаешь вариант A в ЛК ВБ
3. Система автоматически собирает аналитику (каждые 6 часов)
4. Дашборд показывает сравнение + статистическую значимость
5. Система рекомендует когда переключать/завершать тест
6. Финальное решение — за тобой

### Метрики:
- Просмотры, клики, корзина, заказы
- CTR, конверсия
- Статистическая значимость (p-value)

---

## Рич-контент и SEO

### Шаблоны структуры:
- **Стандартный:** Hero-баннер, 3 преимущества, характеристики, как использовать
- **Премиум:** Hero + видео, 5 преимуществ, отзывы, FAQ, гарантии
- **Сравнение:** Мы vs они, таблица, почему мы, гарантии

### AI-заполнение:
1. AI анализирует ключевые слова, отзывы, характеристики
2. GPT-4o генерирует тексты для каждого блока (с SEO-ключами)
3. Nano Banana Pro генерирует изображения блоков
4. SEO-анализ показывает использование ключей

### Экспорт:
- Готовые изображения для загрузки в ЛК ВБ
- HTML-разметка (если поддерживается)

---

## Технический стек

| Компонент | Технология |
|-----------|------------|
| Frontend | Next.js 15 (App Router) + React 19 + TypeScript |
| Стилизация | Tailwind CSS + shadcn/ui |
| Canvas-редактор | Konva.js + react-konva |
| Backend | Convex |
| Хранение файлов | Cloudflare R2 |
| AI изображения | Nano Banana Pro (fal.ai) |
| AI тексты | OpenAI GPT-4o |
| Внешние API | WB API |
| Деплой | Vercel (prod) + локально (dev) |

---

## Структура проекта

```
infographics-gen/
├── app/                          # Next.js App Router
│   ├── page.tsx                  # Главная (список проектов)
│   ├── projects/
│   │   ├── [id]/
│   │   │   ├── page.tsx          # Проект: обзор
│   │   │   ├── generate/page.tsx # Генерация изображений
│   │   │   ├── rich/page.tsx     # Рич-контент
│   │   │   ├── editor/page.tsx   # Canvas-редактор
│   │   │   └── ab-tests/page.tsx # A/B тесты
│   │   └── new/page.tsx          # Создание проекта
│   └── layout.tsx
│
├── components/
│   ├── ui/                       # shadcn компоненты
│   ├── projects/                 # Компоненты проектов
│   ├── generator/                # UI генерации
│   ├── editor/                   # Konva редактор
│   ├── rich-content/             # Рич-контент билдер
│   └── analytics/                # Дашборды, графики
│
├── convex/
│   ├── schema.ts                 # Схема данных
│   ├── projects.ts               # CRUD проектов
│   ├── assets.ts                 # Управление файлами
│   ├── generations.ts            # Логика генерации
│   ├── abTests.ts                # A/B тесты
│   ├── analytics.ts              # Аналитика
│   ├── wb/                       # WB API интеграция
│   │   ├── parser.ts             # Парсинг карточки
│   │   └── analytics.ts          # Получение метрик
│   └── ai/
│       ├── nanoBanana.ts         # Генерация изображений
│       └── openai.ts             # Генерация текстов
│
├── lib/
│   ├── r2.ts                     # Cloudflare R2 клиент
│   ├── prompts.ts                # Шаблоны промптов
│   └── stats.ts                  # Расчёт статзначимости
│
└── public/
    └── templates/                # Шаблоны рич-контента
```

---

## Интеграции

### WB API
```
Парсинг карточки:
- GET /content/v2/get/cards/list — данные карточки
- POST /api/v2/search-report/product/search-texts — ключевые слова
- POST /api/v2/search-report/product/orders — заказы по ключам

Аналитика:
- POST /api/analytics/v3/sales-funnel/products — воронка продаж
- POST /api/analytics/v3/sales-funnel/products/history — история по дням

Авторизация: WB API Token из ЛК продавца
```

### Nano Banana Pro (fal.ai)
```
Endpoint: fal-ai/nano-banana-pro
Input: prompt, image_url (товар), reference_urls (стиль), aspect_ratio
Стоимость: ~$0.10-0.15 за изображение
```

### OpenAI GPT-4o
```
Использование: SEO-тексты для рич-контента
Model: gpt-4o
```

### Cloudflare R2
```
Структура: /{projectId}/products/, /references/, /generated/
Upload: Presigned URLs
```

---

## Будущие улучшения (не в MVP)

- Видео-превью (слайдшоу или AI-генерация)
- Интеграция с Ozon API
- Автоматическая загрузка изображений в ЛК ВБ
- Библиотека готовых стилей
- Командная работа (несколько пользователей)
